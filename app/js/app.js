var app=angular.module("app",["ngRoute","ngTouch","services"]),services=angular.module("services",[]);app.config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"app/views/home.php",controller:"HomeController"}).when("/profil",{templateUrl:"app/views/profil.php",controller:"ProfilController"}).otherwise({redirectTo:"/"})}]),app.controller("AllController",function($scope,Log){$scope.logout=function(){Log.out()}}),app.controller("HomeController",function($scope,Modal){$scope.modalInscription=!1,$scope.showModalInscription=function(){$scope.modalInscription=!0},$scope.showModalConnection=function(){$scope.modalConnection=!0}}),app.controller("ProfilController",function(Session){Session.get()}),services.factory("Api",function($http){var api={};return api.post=function(url,data){return $http({method:"POST",url:url,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8;"},data:api.urlSerialize(data)}).success(function(response){return response}).error(function(data,status,headers,config){var response="error";return console.log(data,status,headers,config),response})},api.get=function(url){return $http({method:"GET",url:url}).success(function(response){return response}).error(function(data,status,headers,config){var response="error";return console.log(data,status,headers,config),response})},api.urlSerialize=function(data){var obj=data,dataUrl="",max=Object.keys(obj).length,i=0;for(var prop in obj)obj.hasOwnProperty(prop)&&(i++,dataUrl+=max>i?prop+"="+obj[prop]+"&":prop+"="+obj[prop]);return dataUrl},api}),services.factory("Log",function(Api,$location){var log={};return log["in"]=function(url){$location.path(url)},log.out=function(){var data={logout:!0};Api.post("back/controls/logoutCtrl.php",data).then(function(response){"logout"===response.data&&$location.path("/")})},log}),services.factory("Session",function(Api,$location){var session={};return session.get=function(){Api.get("back/controls/sessionCtrl.php").then(function(response){"session"!==response.data&&$location.path("/")})},session}),services.factory("Modal",function(Api,Log){var modal={};return modal.init=function(scope){scope.userExist=!1,scope.userNotExist=!1,scope.wrongMail=!1,scope.wrongMailCo=!1,scope.errorModalBackEnd=!1},modal.inputFocus=function(inputId){var label=document.getElementById("label"+inputId);label.classList.add("move")},modal.inputBlur=function(inputId){var input=document.getElementById(inputId),value=input.value,label=document.getElementById("label"+inputId);(""===value||void 0===value)&&label.classList.remove("move")},modal.confirm=function(scope,data){void 0!==data&&(scope.errorModalBackEnd=!1,Api.post("back/controls/authUserCtrl.php",data).then(function(response){if("error"===response)scope.errorModalBackEnd=!0;else switch(response.data){case"userExist":scope.userExist=!0;break;case"wrongMail":scope.wrongMail=!0;break;case"userAdded":scope.modalInscription=!1,Log["in"]("/profil")}}))},modal}),app.directive("inscription",function(Modal){var inscription={restrict:"E",replace:!0,templateUrl:"app/views/inscriptionModal.php",link:function(scope){Modal.init(scope),scope.focusInputModal=function(inputId){Modal.inputFocus(inputId)},scope.blurInputModal=function(inputId){Modal.inputBlur(inputId)},scope.hideModalInscription=function(){scope.modalInscription=!1},scope.confirmInscription=function(user){this.user.inscription="login";var data=angular.copy(user);Modal.confirm(scope,data)}}};return inscription}),app.directive("connection",function(Modal){var connection={restrict:"E",replace:!0,templateUrl:"app/views/connectionModal.php",link:function(scope){Modal.init(scope),scope.focusInputModal=function(inputId){Modal.inputFocus(inputId)},scope.blurInputModal=function(inputId){Modal.inputBlur(inputId)},scope.hideModalConnection=function(){scope.modalConnection=!1},scope.confirmConnection=function(userCo){this.userCo.connection="login";var data=angular.copy(userCo);Modal.confirm(scope,data)}}};return connection});